<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>webfinger.js demo</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <style>
      body { text-align: center; }
      header { with: 100%; background-color: #A6A6A6; color: #FDFEDE;
           padding: 1px; }
      form { margin: 15px; }
      #results { margin: 20px auto 0 auto; padding: 0px; }
      .result { margin: 0; margin-bottom: 50px; }
      #error { height: 18px; }
      p.error { background-color: #FFDEDE; }
    </style>
  </head>

  <body>
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a>!</p>
    <![endif]-->

    <header><h1>webfinger.js demo</h1><p>[<a href="https://github.com/silverbucket/webfinger.js">github repository</a>]</header>

    <article>

      <!-- form -->
      <div>
        <form name="webfinger">
          <div class="label_container"><label for="email_address">enter an email address</label></div>
          <input name="email_address" class="required" value="" size="55"/>
        </form>
        <div id="error"></div>
      </div>

      <!-- display results -->
      <div id="results">

      </div>

    </article>

    <script src="https://raw.github.com/silverbucket/webfinger.js/master/src/webfinger.js"></script>
    <!--<script src="../src/webfinger.js"></script>-->

    <script>
      document.webfinger.email_address.focus();
      document.webfinger.onkeydown = function (evt) {
        var keyCode = evt ? (evt.which ? evt.which : evt.keyCode) : event.keyCode;
        if (keyCode == 13) {
        // enter.
        var email_address = document.webfinger.email_address.value;
        queryWebfinger(email_address);
        return false;
        } else if (keyCode == 27) {
        // escape.
        document.webfinger.email_address.value = '';
        } else {
        document.getElementById('error').innerHTML = '';
        return true;
        }
      };

    </script>
    <script>
      function queryWebfinger(emailAddress) {
        webfinger(emailAddress, function(err, p) {
          if(err) {
            console.log('error getting webfinger data for '+emailAddress+': ' + err);
            console.log(document.getElementById('error'));
            document.getElementById('error').innerHTML = '<p class="error">'+err+' for '+emailAddress+'</p>';

          } else if (p) {
            console.log('webfinger.js result: ', p);

            // build entry html
            var entry = '<div class="result"><h2>';
            if (p.properties.name !== undefined) {  // add name if it's found
              entry = entry + p.properties.name + ' <br />';
            }
            entry = entry + emailAddress + '</h2>';

            if (p.links.avatar[0] !== undefined) {
              entry += '<p><img height="200px" src="'+p.links.avatar+'"></p>'
            }
            p.links.avatar = [];

            for (var e in p.links) {
              var peLen = p.links[e].length;
              for (var i = 0; i < peLen; i = i + 1) {
                entry += '<p>'+e+': <a target="_blank" href="'+p.links[e][i]+'">'+p.links[e][i]+'</a></p>';
              }
            }
            entry += '</div>';

            var results = document.getElementById("results");
            results.insertAdjacentHTML("afterbegin", entry);
          } else {
            document.getElementById('error').innerHTML = '<p class="error">unable to get record for '+emailAddress+'</p>';
          }
        });
      }

      queryWebfinger('nick@silverbucket.net');
      queryWebfinger('paulej@packetizer.com');
    </script>
  </body>
</html>










